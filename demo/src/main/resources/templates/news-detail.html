<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Detail - Q-Airline</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✈️</text></svg>">
    <link rel="stylesheet" href="../css/brand.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f6f8;
            color: var(--qa-text);
            margin: 0;
            padding: 0;
        }

        .qa-navbar {
            background-color: white;
            box-shadow: var(--qa-shadow-sm);
            padding: 1rem 0;
        }

        .qa-navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--qa-primary);
            text-decoration: none;
        }

        .nav-links {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--qa-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--qa-primary);
        }

        .article-container {
            max-width: 900px;
            margin: 2rem auto;
            background-color: white;
            border-radius: var(--qa-radius-lg);
            box-shadow: var(--qa-shadow-md);
            padding: 2rem;
        }

        .article-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .article-category {
            display: inline-block;
            background-color: var(--qa-secondary-light);
            color: var(--qa-secondary-dark);
            padding: 0.3rem 0.8rem;
            border-radius: var(--qa-radius-pill);
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .article-title {
            font-size: 2.5rem;
            color: var(--qa-primary);
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .article-meta {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            color: var(--qa-gray);
            font-size: 0.9rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .meta-item svg {
            width: 1rem;
            height: 1rem;
            color: var(--qa-primary);
        }

        .article-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: var(--qa-radius-md);
            margin-bottom: 2rem;
        }

        .article-content p {
            line-height: 1.8;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        .article-content h2,
        .article-content h3 {
            color: var(--qa-primary);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .article-tags {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .tag {
            display: inline-block;
            background-color: var(--qa-light);
            color: var(--qa-dark);
            padding: 0.4rem 0.8rem;
            border-radius: var(--qa-radius-pill);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .tag:hover {
            background-color: var(--qa-primary);
            color: white;
        }

        .loading-spinner {
            display: none;
            width: 2rem;
            height: 2rem;
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid var(--qa-primary);
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        .error-message {
            text-align: center;
            color: #dc3545;
            padding: var(--qa-spacing-lg);
            display: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .article-container {
                padding: var(--qa-spacing-lg);
            }

            .article-title {
                font-size: 2rem;
            }

            .article-image {
                height: 300px;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--qa-spacing-sm);
            }
        }

        /* Custom Icons */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            vertical-align: -0.125em;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="qa-navbar">
        <div class="container">
            <a class="navbar-brand" href="index.">Q-Airline</a>
            <ul class="nav-links">
                <li><a href="index">Home</a></li>
                <li><a href="flights">Flights</a></li>
                <li><a href="tickets">My Tickets</a></li>
                <li><a class="active" href="news">News</a></li>
                <li><a href="login">Login</a></li>
                <li><a href="register">Register</a></li>
            </ul>
        </div>
    </nav>

    <!-- Article Container -->
    <div class="article-container">
        <div id="articleContent">
            <!-- Article content will be loaded here -->
            <div class="loading-spinner"></div>
            <div class="error-message">Failed to load article. Please try again later.</div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="qa-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h5>Q-Airline</h5>
                    <p>Your trusted partner in air travel.</p>
                </div>
                <div class="footer-section">
                    <h5>Quick Links</h5>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h5>Contact Us</h5>
                    <p>Email: info@qairline.com<br>
                    Phone: +1 234 567 890</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const articleContent = document.getElementById('articleContent');
        const loadingSpinner = document.querySelector('.loading-spinner');
        const errorMessage = document.querySelector('.error-message');

        // Helper function to parse date array (similar to tickets.html)
        function parseDateArray(dateArray) {
            if (!dateArray || dateArray.length < 5) {
                return null;
            }
            // Date constructor expects month to be 0-indexed
            return new Date(dateArray[0], dateArray[1] - 1, dateArray[2], dateArray[3], dateArray[4], dateArray.length > 5 ? dateArray[5] : 0);
        }

        // Format date
        function formatDate(dateValue) {
            let date;
            if (Array.isArray(dateValue)) {
                date = parseDateArray(dateValue);
            } else {
                date = new Date(dateValue); // Assume it's a string if not an array
            }

            if (!date || isNaN(date.getTime())) {
                return "Invalid Date";
            }
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('en-US', options);
        }

        // Load article
        async function loadArticle() {
            loadingSpinner.style.display = 'block';
            errorMessage.style.display = 'none';

            try {
                const urlParams = new URLSearchParams(window.location.search);
                const articleId = urlParams.get('id');

                if (!articleId) {
                    throw new Error('Article ID not provided');
                }

                const response = await fetch(`/api/news/${articleId}`);

                if (!response.ok) {
                    throw new Error('Failed to load article');
                }

                const article = await response.json();

                // Update page title
                document.title = `${article.title || 'News'} - Q-Airline`; // Default title if article.title is missing

                // Ensure article properties are not null/undefined for rendering
                const category = article.category || 'General';
                const title = article.title || 'No Title';
                const imageUrl = article.imageUrl || '';
                const content = article.content || '';
                const publishDate = article.publishDate ? formatDate(article.publishDate) : 'Invalid Date';
                const author = article.author || 'Unknown Author';
                const readingTime = article.readingTime || 0;
                const tags = Array.isArray(article.tags) ? article.tags : [];


                // Render article
                articleContent.innerHTML = `
                    <div class="article-header">
                        <span class="article-category">${category}</span>
                        <h1 class="article-title">${title}</h1>
                        <div class="article-meta">
                            <div class="meta-item">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>
                                </svg>
                                ${publishDate}
                            </div>
                            <div class="meta-item">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                </svg>
                                ${author}
                            </div>
                            <div class="meta-item">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                </svg>
                                ${readingTime} min read
                            </div>
                        </div>
                    </div>
                    <img src="${imageUrl}" alt="${title}" class="article-image">
                    <div class="article-content">
                        ${content}
                    </div>
                    <div class="article-tags">
                        ${tags.map(tag => `
                            <a href="news?tag=${encodeURIComponent(tag)}" class="tag">#${tag}</a>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading article:', error);
                errorMessage.style.display = 'block';
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        // Initial load
        loadArticle();
    </script>
</body>
</html>
